import{_ as $,o as n,c as i,a as o,t as c,J as C,f as u,u as U,r as z,b as g,w as P,e as s,q as B,i as k,I as D}from"./index-_YVCG4aW.js";import{N as R}from"./NavBar-Ch6YB5vX.js";/* empty css                  */import{u as q,a as N,c as w,F as Z}from"./index.esm-DBJyLCxb.js";import{u as V}from"./token-DW84-UJB.js";import{a as x}from"./axios-Cm0UX6qg.js";import{n as A}from"./httputils-DfwDMwwy.js";import{E as K}from"./EditKnowlegde-B9T4D_-m.js";const M={class:"element"},T={class:"heading"},J=["value"],j={key:0,class:"error"},G={__name:"EditInputElement",props:{label:{type:String,default:""},modelValue:{type:[String,Number],default:""},error:String},emits:["update:modelValue"],setup(d,{emit:b}){const l=b,_=m=>{l("update:modelValue",m.target.value)};return(m,y)=>(n(),i("div",M,[o("label",T,c(d.label),1),o("input",{class:C(["inputField",{"is-error":d.error}]),value:d.modelValue,onInput:_,name:"inputField",minlength:"2",maxlength:"30"},null,42,J),d.error?(n(),i("span",j,c(d.error),1)):u("",!0)]))}},E=$(G,[["__scopeId","data-v-d0972c04"]]),H={class:"flex-container"},O=D('<div class="header"><div class="left-content"></div><div class="middle-content"><h1 class="title">Rediger profil</h1></div><div class="right-content"></div></div>',1),Q={class:"main",id:"profile"},W={class:"centered-content"},X={key:0,class:"error"},Y={key:1,class:"error"},ee={key:2,class:"error"},te=o("br",null,null,-1),se=o("br",null,null,-1),oe=o("h3",null,"Kunnskapsnivå",-1),ae=o("br",null,null,-1),le=o("br",null,null,-1),ne={key:1,class:"error"},re=["disabled"],ie=o("br",null,null,-1),de=o("br",null,null,-1),ue={class:"footer"},ke={__name:"EditProfileView",setup(d){const{handleSubmit:b,errors:l,meta:_}=q(),m=U(),y=/^[A-Za-z\s-]+$/,I=/^[a-zA-Z0-9._%+-æøåÆØÅ]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,h=z(""),F=V(),{value:p}=N("firstName",w().required("Fornavn må fylles ut").matches(y,"Fornavn kan bare inneholde bokstaver")),{value:v}=N("lastName",w().required("Etternavn må fylles ut").matches(y,"Etternavn kan bare inneholde bokstaver")),{value:f}=N("email",w().required("Epost må fylles ut").matches(I,"Må være en gyldig epost"));let r="";(async()=>{try{const a=V(),e=await x.get("http://idatt2105-32.idi.ntnu.no:8080/api/users/"+a.getLoggedInUser(),a.getAxiosAuthorizationConfig());if(e.status===200){const t=e.data;p.value=t.firstName,v.value=t.lastName,f.value=t.email,r=t.knowledgeLevel}else await m.push("/login")}catch(a){console.error("Error fetching data:",a)}})();const S=async()=>{try{const a=V(),e={firstName:p.value,lastName:v.value,email:f.value,knowledgeLevel:r};(await x.put("http://idatt2105-32.idi.ntnu.no:8080/api/users/"+a.getLoggedInUser(),e,a.getAxiosAuthorizationConfig())).status===200?await A("/profile"):console.error("Feil ved oppdatering av profil")}catch(a){a.response&&a.response.status===409&&(console.error("Mail already registered"),h.value="Eposten er allerede registrert"),console.error("Feil ved oppdatering av profil:",a)}},L=async()=>{if(confirm("Er du sikker på at du vil slette brukeren?"))try{const e=await x.delete("http://idatt2105-32.idi.ntnu.no:8080/api/users/"+F.getLoggedInUser(),F.getAxiosAuthorizationConfig());console.log(e.data),await m.push("/")}catch(e){e.response&&e.response.status===404&&(console.error("User not found"),h.value="Noe gikk galt"),console.error("Login failed:",e)}};return(a,e)=>(n(),i("div",H,[O,o("div",Q,[o("div",W,[g(s(Z),{onSubmit:e[3]||(e[3]=t=>s(b)(S))},{default:P(()=>[s(l).firstName?(n(),i("span",X,c(s(l).firstName),1)):u("",!0),g(E,{label:"Fornavn",type:"text",modelValue:s(p),"onUpdate:modelValue":e[0]||(e[0]=t=>k(p)?p.value=t:null),name:"firstName"},null,8,["modelValue"]),s(l).lastName?(n(),i("span",Y,c(s(l).lastName),1)):u("",!0),g(E,{label:"Etternavn",type:"text",modelValue:s(v),"onUpdate:modelValue":e[1]||(e[1]=t=>k(v)?v.value=t:null),name:"lastName"},null,8,["modelValue"]),s(l).email?(n(),i("span",ee,c(s(l).email),1)):u("",!0),g(E,{label:"Email",type:"text",modelValue:s(f),"onUpdate:modelValue":e[2]||(e[2]=t=>k(f)?f.value=t:null),name:"email"},null,8,["modelValue"])]),_:1}),o("button",{class:"btn",id:"changePassword",onClick:e[4]||(e[4]=t=>s(A)("/editPassword"))},"Endre passord"),te,se,oe,s(r)!==""?(n(),B(K,{key:0,knowledgeLevel:s(r),onKnowledge:e[5]||(e[5]=t=>k(r)?r.value=t:r=t)},null,8,["knowledgeLevel"])):u("",!0),ae,le,h.value?(n(),i("div",ne,c(h.value),1)):u("",!0),o("button",{class:"btn",id:"edit",onClick:S,disabled:!s(_).valid||!s(_).dirty},"Lagre",8,re),ie,de,o("button",{class:"btn",id:"delete",onClick:L},"Slett bruker")])]),o("div",ue,[g(R)])]))}};export{ke as default};
